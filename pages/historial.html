<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>AdoptaPet - Historial</title>
    <!-- CSS Link, Absolute Bootstrap Link & Animate Link-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../css/historial.css"/>
    <!--SEO Metas-->
    <meta name="description" content="AdoptaPet es el sitio para buscar y adoptar a tu próxima mascota, ó informar sobre mascotas perdidas o callejeras para ayudarlas a conseguir a su nueva familia.">
    <meta name="keywords"  content="MASCOTAS, ADOPTAR, PERROS, GATOS, MAPA, AYUDAR, ANIMALES, CALLE, PERDIDOS">
    <style>
        .uploaded-photos img {
            max-width: 100px; 
            max-height: 100px; 
            margin-right: 10px; 
        }
        table img {
            max-width: 100px; 
            height: auto; 
        }
    </style>
</head>
<body>
    <div class="container-fluid px-0">
        <!--Header-->
        <nav class="navbar navbar-expand-lg navbar-dark header">
            <a class="navbar-brand" href="index.html">
                <img src="../media/adoptapet.png" alt="firus">
            </a>
            <button class="navbar-toggler mr-4" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item ">
                  <a class="nav-link" href="../index.html">Inicio</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="buscar.html">Buscar</a>
                </li>
                <li class="nav-item active">
                  <a class="nav-link" href="historial.html">Historial<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item " id="borrar1">
                  <a class="nav-link" href="albergues.html">Albergue</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="buscar_albergue.html">Buscar Albergue</a>
                </li>
                <li class="nav-item" id="borrar2">
                  <a class="nav-link" href="categoria.html">Categorias</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="user/mis_publicaciones.html">Mis publicaciones</a>
                </li>
                <li class="nav-item" id="cambio">
                  <a class="nav-link" href="login.html">Login</a>
              </li>
              </ul>
            </div>
        </nav>
        <!--Contenido Principal-->
        <div class="container">
            <!--Titulo-->
            <div class="container__title">
                <h1>Historial</h1>
            </div>
            <div class="row mt-5">
                <!-- Tabla 1 con 2 columnas -->
                <div class="col-md-6">
                    <table id="tabla1" class="table table-striped mt-3">
                        <thead>
                            <tr>
                                <th colspan="2">Adoptados</th>
                            </tr>
                        </thead>
                        <tbody id="adoptados">
                        </tbody>
                    </table>
                </div>
                <!-- Tabla 2 con 3 columnas -->
                <div class="col-md-6">
                    <table id="tabla2" class="table table-striped mt-3">
                        <thead>
                            <tr>
                                <th colspan="3">Mis mascotas en Adopcion</th>
                            </tr>
                        </thead>
                        <tbody id="misMascotas">

                            <!-- Puedes agregar más filas aquí -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="verModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Datos del cliente</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Contenido del modal -->
                    <p>Nombre: Juan</p>
                    <p>Apellido: Pérez</p>
                    <p>Celular: 123-456-7890</p>
                    <p>Correo: juan.perez@example.com</p>
                    <p>Observaciones: .</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <!--Publicidad para Redes Sociales-->
    <div class="container text-center">
      <h4>Visita nuestras Redes para saber las ultimas noticias!</h4>
        <hr class="my-4">
      <div class="container__iconos">
        <a href="https://www.instagram.com/"><img src="../media/icons/instagram.png" alt="Instagram"></a>
        <a href="https://www.twitter.com/"><img src="../media/icons/twitter.png" alt="Twitter"></a>
        <a href="https://www.facebook.com/"><img src="../media/icons/facebook.png" alt="Facebook"></a>
        <a href="https://www.youtube.com/"><img src="../media/icons/youtube.png" alt="Youtube"></a>
      </div>
    </div>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
  <!--Footer-->
    <nav class="navbar navbar-expand-lg navbar-dark footer justify-content-between">
      <div class="justify-content-start footer__iconos" id="navbarNav">
        <a href="https://www.instagram.com/"><img src="../media/icons/instagram.png" alt="Instagram"></a>
        <a href="https://www.twitter.com/"><img src="../media/icons/twitter.png" alt="Twitter"></a>
        <a href="https://www.facebook.com/"><img src="../media/icons/facebook.png" alt="Facebook"></a>
        <a href="https://www.youtube.com/"><img src="../media/icons/youtube.png" alt="Youtube"></a>
      </div>
      
      <div class="footer__title">
      <p>AdoptaPet ONG</p>
      </div>

      <div class="justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item ">
              <a class="nav-link" href="../index.html">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="buscar.html">Buscar</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="albergues.html">Albergue</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="historial.html">Historial<span class="sr-only">(current)</span></a>
              </li>
            <li class="nav-item">
              <a class="nav-link" href="informar.html">Informar</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="contacto.html">Contacto</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="login.html">Login</a>
          </li>
          </ul>
      </div>
    </nav>
    <!-- Bootstrap y scripts JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        let idUsuario = localStorage.getItem('clave');
        ListarAdopciones(idUsuario);
        ListarMisMascotas(idUsuario);
        if(localStorage.getItem('clave') != 1) {
          document.getElementById("borrar1").innerHTML = ''
          document.getElementById("borrar2").innerHTML = ''
        }
        if(localStorage.getItem('token') == null || localStorage.getItem('token') == "") {
          document.getElementById("cambio").innerHTML = '<a class="nav-link" href="pages/login.html">Login</a>';
        }else {
          document.getElementById("cambio").innerHTML = '<a class="nav-link" href="login.html">Cerrar Sesion</a>';
        }
      });
      function ListarAdopciones(id) {
        const url = 'https://apimascota.azurewebsites.net/Adoptados/' + id;
        const token = localStorage.getItem('token');
          fetch(url, {
              method: 'GET',
              headers: {
                  'Content-Type': 'application/json',
                  'Authorization': 'Bearer ' + token
              }
          })
          .then(response => response.json())
          .then(data => {
              console.log('data mis postulaciones:', data.data);
              let contenido = "";
              for(let i = 0; i < data.data.length; i++) {
                let tr = "<tr>"
                  tr = tr + "<td>" + data.data[i].Nombre + "</td>";
                  if(data.data[i].Estado == 1) {
                    tr = tr + "<td>En Proceso</td>";
                  }
                  if(data.data[i].Estado == 2) {
                    tr = tr + "<td>Aprobado</td>";
                  }
                  if(data.data[i].Estado == 3) {
                    tr = tr + "<td>Rechazado</td>";
                  }
                  tr = tr + "</tr>"
                  contenido = contenido + tr;
              }
              document.getElementById("adoptados").innerHTML = contenido;
          })
          .catch(error => {
            console.error('Error al obtener las categorías:', error);
          });
      }
      function ListarMisMascotas(id) {
        const url = 'https://apimascota.azurewebsites.net/MisMascota/' + id;
        const token = localStorage.getItem('token');
          fetch(url, {
              method: 'GET',
              headers: {
                  'Content-Type': 'application/json',
                  'Authorization': 'Bearer ' + token
              }
          })
          .then(response => response.json())
          .then(data => {
              console.log('data mis mascotas:', data.data);
              let contenido = "";
              for(let i = 0; i < data.data.length; i++) {
                let tr = "<tr>"
                  tr = tr + "<td>" + data.data[i].Nombre + "</td>";
                  if(data.data[i].Estado == 1) {
                    tr = tr + '<td><div class="form-group"><select class="custom-select form-control" id="validationCustom04" onchange = "actualizar(' + data.data[i].IdHistorial + ')" required><option value="1" selected>En espera</option><option value="2">Aprobado</option><option value="3">Rechazado</option></select></div></td>';
                  }
                  if(data.data[i].Estado == 2) {
                    tr = tr + '<td><div class="form-group"><select class="custom-select form-control" id="validationCustom04" onchange = "actualizar(' + data.data[i].IdHistorial + ')" required><option value="1">En espera</option><option value="2" selected>Aprobado</option><option value="3">Rechazado</option></select></div></td>';
                  }
                  if(data.data[i].Estado == 3) {
                    tr = tr + '<td><div class="form-group"><select class="custom-select form-control" id="validationCustom04" onchange = "actualizar(' + data.data[i].IdHistorial + ')" required><option value="1">En espera</option><option value="2">Aprobado</option><option value="3" selected>Rechazado</option></select></div></td>';
                  }
                  tr = tr + '<td><button type="button" class="btn btn-primary verBtn" data-toggle="modal" data-target="#verModal1">Ver</button></td>'
                  tr = tr + "</tr>"
                  contenido = contenido + tr;
              }
              document.getElementById("misMascotas").innerHTML = contenido;
          })
          .catch(error => {
            console.error('Error al obtener las categorías:', error);
          });
      }
     function actualizar(id) {
      let estado = document.getElementById("validationCustom04").value;
      console.log("en el actualizar: " + estado + " id: " + id);

      const token = localStorage.getItem('token');

            const url = 'https://apimascota.azurewebsites.net/api/Historial/1';
            const data = {
              "idHistorial": id,
              "estado": estado
            };
            fetch(url, {
                method: 'PUT', 
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token  
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                if (data.codigo > 0) {
                    alert('Se axtualizo correctamente');
                } else {
                    alert(data.mensaje);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
     }
    </script>
  </body>
</html>
