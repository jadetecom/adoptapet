<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/registrar.css">
</head>
<body>
    <section>
        <article class="sector1">
            <img src="img/fondoGato.jpg" id="izquierdo">
        </article>
        <article class="sector2">
            <div class="contenedor">
                <div class="row">
                    <h1 class="centrado">Recuperar Contraseña</h1>
                </div>
                <div class="row">
                    <h3 class="centrado">Recuperar Contraseña</h3>
                </div>
                <div class="bloque">
                    <form action="../index.html" method="POST">
                        <div class="row">
                            <div class="col-3">
                                <label for="email">Email</label>
                            </div>
                            <div class="col-8">
                                <input type="tel" class="ajuste" id="email" name="email" placeholder="Tu Email" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <label for="palabraClave">P Clave</label>
                            </div>
                            <div class="col-8">
                               <input type="text" class="ajuste" id="palabraClave" name="palabraClave" placeholder="Tu Palabra Clave" required>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <label for="password1">Password</label>
                            </div>
                            <div class="col-8">
                               <input type="password" class="ajuste" id="password1" name="password1" placeholder="Tu password" required>
                        </div>
                        <div class="row">
                            <div class="col-3">
                                <label for="password2">Repetir Password</label>
                            </div>
                            <div class="col-8">
                               <input type="password" class="ajuste" id="password2" name="password2" placeholder="Tu password" required>
                        </div>
                       <div class="row">
                            <button type="button" id="recuperar">
                                Recuperar Contraaseña
                            </button>
                       </div> 
                    </form>
                    <div class="row centrado">
                        <a href="login.html">Si ya te acuerdas tu contraseña, ingresa aquí</a>
                    </div>
                </div>
            </div>
        </article>
    </section>
    <script>
        document.getElementById('recuperar').addEventListener('click', function() {

                const correo = document.getElementById('email').value;
                const password = document.getElementById('password1').value;
                const password2 = document.getElementById('password2').value;
                const palabraClave = document.getElementById('palabraClave').value;
                if(password2 == password2) {
                    const data = {
                        usuario: correo,
                        clave: password,
                        palabraClave: palabraClave
                    };
                    const url = 'https://apimascota.azurewebsites.net/api/Usuario';
                    fetch(url, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.codigo > 0) {
                            alert('se recupero completado con éxito');
                            window.location.href = '../index.html';
                        }else {
                            alert('Error');
                            console.log(data);
                        }
                    })
                    .catch((error) => {
                        alert('Error al realizar el registro');
                    });
                }else {
                    alert('la nueva ontraseña no son iguales');
                }
        });
        </script>
</body>
</html>